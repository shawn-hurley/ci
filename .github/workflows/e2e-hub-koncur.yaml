name: Run Koncur with tackle-hub config e2e

on:
  workflow_call:
    # There should be no need to pass in anything as we should have all we need
    # based on the github context
  workflow_dispatch:
    inputs:
      repo:
        description: |
          This is the repo to simulate the testing from.
      ref:
        description: |
          The ref that should be tested from. Could be a branch or PR. that should be used to pull all konveyor related repos.
          For example, if you wanted to set a nightly build for release-0.8, you would specify
          "release-0.8".
        required: false
        type: string
        default: main 

jobs:

  build-images:
    uses: ./.github/workflows/e2e-image-build.yaml
    with:
      repo: ${{ inputs.repo || github.repository }}
      ref: ${{ inputs.ref || github.ref }}
    secrets: inherit

  run-koncur-action:
    runs-on: ubuntu-latest
    needs: build-images
    steps:
      - name: Run Koncur Testing
        uses: konveyor/ci/koncur-tackle-hub@main
        with:
          image_pattern: |
            *{tackle-keycloak-init,tackle2-*,provider}--${{ github.run_id }}
          ref: ${{ github.base_ref || inputs.ref || github.ref_name}}
